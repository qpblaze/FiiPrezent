@using FiiPrezent.Models
@model EventViewModel

@{
    ViewBag.Title = "Event";
    Layout = "_Layout";
}

<div class="hero-image-container">
    <div class="hero-image"></div>
</div>

<div class="container">
    <div class="col-md-12">
        <div class="search-container">
            <div class="title">
                <h2>@Model.Name</h2>
            </div>
            <div class="desc">
                @Model.Description
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-6 offset-md-5">
                            <ol id="participants">
                                @foreach (var p in Model.Participants)
                                {
                                    <li>@p</li>
                                }
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
    {
    <script>
        var eventId = window.location.pathname.substring(window.location.pathname.lastIndexOf("/") + 1);
        var participantsList = document.getElementById("participants");
        var connection = new signalR.HubConnection("/participants?eventId=" + eventId);

        function appendParticipant(name) {
            var li = document.createElement("li");
            li.innerText = name;
            participantsList.appendChild(li);
        }

        connection.on('Update', (list) => {
            participantsList.innerHTML = "";
            list.forEach(function (el) {
                appendParticipant(el);
            });
        });

        connection.start();
    </script>
}